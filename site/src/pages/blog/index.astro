---
import Base from '../../layouts/Base.astro';
import { loadAllContent } from '../../lib/state';
import type { ProjectedBlog } from '../../lib/state';

const posts = loadAllContent('blog') as ProjectedBlog[];
const base = import.meta.env.BASE_URL.replace(/\/$/, '');
---
<Base
  title="Blog"
  description="All blog posts."
  breadcrumbs={[
    { label: 'Blog', href: `${base}/blog/` },
  ]}
>
  <section class="home-section">
    <h1>Blog</h1>
    {posts.length > 0 ? (
      <ul class="content-list-cards">
        {posts.map((p) => (
          <li>
            <a class="list-card" href={`${base}/blog/${p.meta.slug}/`}>
              <div class="list-card-body">
                <div class="list-card-title">{p.meta.title}</div>
                <div class="list-card-meta">
                  {(p.current_revision?.ts ?? p.meta.updated_at) && (
                    <time datetime={p.current_revision?.ts ?? p.meta.updated_at}>
                      {new Date(p.current_revision?.ts ?? p.meta.updated_at)
                        .toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}
                    </time>
                  )}
                  {p.meta.tags.length > 0 && (
                    <span class="tags">
                      {p.meta.tags.map((t: string) => <span class="tag">{t}</span>)}
                    </span>
                  )}
                </div>
              </div>
              <span class="list-card-arrow">â†’</span>
            </a>
          </li>
        ))}
      </ul>
    ) : (
      <p class="empty-page">No blog posts published yet.</p>
    )}
  </section>
</Base>
